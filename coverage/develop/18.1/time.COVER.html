<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>/home/travis/build/SoamJaws/wErld/.eunit/time.COVER.html</title>
</head><body style='background-color: white; color: black'>
<pre>
File generated from /home/travis/build/SoamJaws/wErld/.eunit/time.erl by COVER 2016-07-22 at 07:02:57

****************************************************************************

        |  -module(time).
        |  -include("time.hrl").
        |  -include("logger.hrl").
        |  -behaviour(gen_server).
        |  
        |  %% Public API
        |  -export([ ?SUBSCRIBE/1
        |          , ?SUBSCRIBE/2
        |          , ?GET_CURRENT_TIME/0]).
        |  
        |  %% gen_server
        |  -export([ start_link/2
        |          , init/1
        |          , handle_call/3
        |          , handle_cast/2
        |          , handle_info/2
        |          , terminate/2
        |          , code_change/3]).
        |  
        |  %% Public API
        |  
        |  -spec ?SUBSCRIBE(gen_address()) -&gt; ok.
        |  ?SUBSCRIBE(Subscriber) -&gt;
     8..|    ?SUBSCRIBE(Subscriber, false).
        |  
        |  -spec ?SUBSCRIBE(gen_address(), boolean()) -&gt; ok.
        |  ?SUBSCRIBE(Subscriber, BlockCaller) -&gt;
     8..|    gen_server_utils:cast({global, ?MODULE}, {?SUBSCRIBE, Subscriber}, BlockCaller).
        |  
        |  -spec ?GET_CURRENT_TIME() -&gt; non_neg_integer().
        |  ?GET_CURRENT_TIME() -&gt;
     8..|    gen_server:call({global, ?MODULE}, ?GET_CURRENT_TIME).
        |  
        |  
        |  %% gen_server
        |  
        |  -spec start_link(non_neg_integer(), pos_integer()) -&gt; {ok, pid()} | ignore | {error, {already_started, pid()} | term()}.
        |  start_link(Delta, Frequency) -&gt;
<font color=red>     0..|    gen_server:start_link({global, ?MODULE}, ?MODULE, {Delta, Frequency}, []).</font>
        |  
        |  
        |  -spec init({non_neg_integer(), pos_integer()}) -&gt; {ok, time_state()}.
        |  init({Delta, Frequency}) -&gt;
<font color=red>     0..|    put(id, time),</font>
<font color=red>     0..|    put(module, ?MODULE_STRING),</font>
<font color=red>     0..|    gen_server:cast(self(), tick),</font>
<font color=red>     0..|    {ok, #time_state{delta=Delta, frequency=Frequency, subscribers=[], time=0}}. % Epoch in gregorian seconds</font>
        |  
        |  
        |  -spec handle_call(?GET_CURRENT_TIME, {pid(), any()}, time_state()) -&gt; {reply, time(), time_state()}.
        |  handle_call(?GET_CURRENT_TIME, _From, State) -&gt;
<font color=red>     0..|    {reply, State#time_state.time, State}. </font>
        |  
        |  
        |  -spec handle_cast({?SUBSCRIBE, gen_address()}, time_state()) -&gt; {noreply, time_state()}
        |        ;          (tick, time_state()) -&gt; {noreply, time_state()}.
        |  handle_cast({?SUBSCRIBE, Subscriber}, State) -&gt;
<font color=red>     0..|    Subscribers = State#time_state.subscribers,</font>
<font color=red>     0..|    {noreply, State#time_state{subscribers=[Subscriber|Subscribers]}};</font>
        |  
        |  handle_cast(tick, State) -&gt;
<font color=red>     0..|    timer:sleep(State#time_state.frequency),</font>
<font color=red>     0..|    gen_server:cast(self(), tick),</font>
<font color=red>     0..|    NewTime = State#time_state.time + State#time_state.delta,</font>
<font color=red>     0..|    broadcast_time(State#time_state.subscribers, NewTime),</font>
<font color=red>     0..|    {noreply, State#time_state{time=NewTime}}.</font>
        |  
        |  
        |  -spec handle_info(timeout | any(), time_state()) -&gt; {noreply, time_state()}.
        |  handle_info(_Info, State) -&gt;
<font color=red>     0..|    {noreply, State}.</font>
        |  
        |  
        |  -spec terminate(normal | shutdown | {shutdown, any()} | any(), time_state()) -&gt; ok.
        |  terminate(_Reason, _State) -&gt;
<font color=red>     0..|    ok.</font>
        |  
        |  
        |  -spec code_change(term() | {down, term()}, time_state(), term()) -&gt; {ok, time_state()}.
        |  code_change(_OldVsn, State, _Extra) -&gt;
<font color=red>     0..|    {ok, State}.</font>
        |  
        |  
        |  %% Helpers
        |  
        |  -spec broadcast_time([gen_address()], time()) -&gt; ok.
<font color=red>     0..|  broadcast_time([], _Time) -&gt; ok;</font>
        |  broadcast_time([Subscriber|Subscribers], Time) -&gt;
<font color=red>     0..|    Module = gen_server_utils:extract_module(Subscriber),</font>
<font color=red>     0..|    apply(Module, ?NEW_TIME, [Subscriber, Time]),</font>
<font color=red>     0..|    broadcast_time(Subscribers, Time).</font>
</pre>
</body>
</html>
