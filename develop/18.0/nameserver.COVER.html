<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>/home/travis/build/SoamJaws/wErld/.eunit/nameserver.COVER.html</title>
</head><body style='background-color: white; color: black'>
<pre>
File generated from /home/travis/build/SoamJaws/wErld/.eunit/nameserver.erl by COVER 2016-06-21 at 05:57:13

****************************************************************************

        |  %%====================================================================
        |  %%
        |  %% @author Johan Wikström Schützer &lt;johan.dss@gmail.com&gt;
        |  %% @copyright 2015 DrippingBits
        |  %%
        |  %% This is the global nameserver. It is a globally registered process
        |  %% used for looking up processes by name. Any process may subscribe
        |  %% to any name in the nameserver if it has a name to lookup. Any
        |  %% process that should be published in the nameserver should publish
        |  %% itself.
        |  %%
        |  %%====================================================================
        |  -module(nameserver).
        |  -compile(export_all).
        |  
        |  -behaviour(gen_server).
        |  -export([start_link/0, stop/0, subscribe/1, unsubscribe/1, publish/2, unpublish/1]).
        |  -export([init/1, handle_call/3, handle_cast/2, handle_info/2, terminate/2, code_change/3]).
        |  
        |  %%====================================================================
        |  %% Public API
        |  %%====================================================================
        |  
        |  start_link() -&gt;
<font color=red>     0..|    gen_server:start_link({global, ?MODULE}, ?MODULE, [], []).</font>
        |  
        |  stop() -&gt;
<font color=red>     0..|    gen_server:call({global, ?MODULE}, stop).</font>
        |  
        |  subscribe(Name) -&gt;
<font color=red>     0..|    gen_server:call({global, ?MODULE}, {subscribe, Name}).</font>
        |  
        |  unsubscribe(Name) -&gt;
<font color=red>     0..|    gen_server:call({global, ?MODULE}, {unsubscribe, Name}).</font>
        |  
        |  publish(Name, Pid) -&gt;
<font color=red>     0..|    gen_server:call({global, ?MODULE}, {publish, Name, Pid}).</font>
        |  
        |  unpublish(Name) -&gt;
<font color=red>     0..|    gen_server:call({global, ?MODULE}, {unpublish, Name}).</font>
        |  
        |  %%====================================================================
        |  %% Internal functions
        |  %%====================================================================
        |  
<font color=red>     0..|  notifyPublished(_Name, _Pid, []) -&gt; ok;</font>
        |  notifyPublished(Name, Pid, [H|T]) -&gt;
<font color=red>     0..|    gen_server:cast(H, {published, Name, Pid}),</font>
<font color=red>     0..|    notifyPublished(Name, Pid, T).</font>
        |  
<font color=red>     0..|  notifyUnpublished(_Name, []) -&gt; ok;</font>
        |  notifyUnpublished(Name, [H|T]) -&gt;
<font color=red>     0..|    gen_server:cast(H, {unpublished, Name}),</font>
<font color=red>     0..|    notifyUnpublished(Name, T).</font>
        |  
        |  %%====================================================================
        |  %% gen_server callbacks
        |  %%====================================================================
        |  
        |  init([]) -&gt;
<font color=red>     0..|    {ok, {dict:new(), dict:new()}}.</font>
        |  
        |  handle_call(stop, _From, {Publications, Subscribers}) -&gt;
<font color=red>     0..|    {stop, normal, stopped, {Publications, Subscribers}};</font>
        |  
        |  handle_call({subscribe, Name}, From, {Publications, Subscribers}) -&gt;
<font color=red>     0..|    UpdatedSubscribers = dict:append(Name, From, Subscribers),</font>
<font color=red>     0..|    NamePublished = dict:is_key(Name, Publications),</font>
<font color=red>     0..|    if</font>
        |      NamePublished -&gt;
<font color=red>     0..|        Pid = dict:fetch(Name, Publications),</font>
<font color=red>     0..|        notifyPublished(Name, Pid, [From])</font>
        |    end,
<font color=red>     0..|    {noreply, {Publications, UpdatedSubscribers}};</font>
        |  
        |  handle_call({unsubscribe, Name}, _From, {Publications, Subscribers}) -&gt;
<font color=red>     0..|    UpdatedSubscribers = dict:erase(Name, Subscribers),</font>
<font color=red>     0..|    {noreply, {Publications, UpdatedSubscribers}};</font>
        |  
        |  handle_call({publish, Name, Pid}, _From, {Publications, Subscribers}) -&gt;
<font color=red>     0..|    notifyPublished(Name, Pid, dict:fetch(Name, Subscribers)),</font>
<font color=red>     0..|    UpdatedPublications = dict:store(Name, Pid, Publications),</font>
<font color=red>     0..|    {noreply, {UpdatedPublications, Subscribers}};</font>
        |  
        |  handle_call({unpublish, Name}, _From, {Publications, Subscribers}) -&gt;
<font color=red>     0..|    notifyUnpublished(Name, dict:fetch(Name, Subscribers)),</font>
<font color=red>     0..|    UpdatedPublications = dict:erase(Name, Publications),</font>
<font color=red>     0..|    {noreply, {UpdatedPublications, Subscribers}}.</font>
        |  
        |  
        |  handle_cast(_Msg, State) -&gt;
<font color=red>     0..|    {noreply, State}.</font>
        |  
        |  
        |  handle_info(_Info, State) -&gt;
<font color=red>     0..|    {noreply, State}.</font>
        |  
        |  
        |  terminate(_Reason, _State) -&gt;
<font color=red>     0..|    ok.</font>
        |  
        |  
        |  code_change(_OldVsn, State, _Extra) -&gt;
<font color=red>     0..|    {ok, State}.</font>
</pre>
</body>
</html>
