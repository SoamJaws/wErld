<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>/home/travis/build/SoamJaws/wErld/.eunit/line.COVER.html</title>
</head><body style='background-color: white; color: black'>
<pre>
File generated from /home/travis/build/SoamJaws/wErld/.eunit/line.erl by COVER 2016-07-05 at 15:34:40

****************************************************************************

        |  -module(line).
        |  -include("public_transport.hrl").
        |  -behaviour(gen_server).
        |  
        |  %% Public API
        |  -export([ start_link/3
        |          , stop/1
        |          , state/1
        |          , ?GET_NEXT_STOP/3
        |          , ?GET_NEIGHBORS/2
        |          , ?GET_OTHER_END/2
        |          , ?CONTAINS_STOP/2
        |          , ?GET_DURATION/3
        |          , ?IS_END_STOP/2
        |          , ?GET_INTERSECTION/2
        |          , ?GET_NUMBER/1
        |          , ?GET_TARGET/3]).
        |  
        |  %% gen_server
        |  -export([ init/1
        |          , handle_call/3
        |          , handle_cast/2
        |          , handle_info/2
        |          , terminate/2
        |          , code_change/3]).
        |  
        |  
        |  %% Public API
        |  
        |  -spec start_link(pos_integer(), [pid() | pos_integer()], vehicle_type()) -&gt; {ok, pid()} | ignore | {error, {already_started, pid()} | term()}.
        |  start_link(Number, Stops, Type) -&gt;
     8..|    gen_server:start_link(?MODULE, {Number, Stops, Type}, []).
        |  
        |  -spec stop(pid()) -&gt; ok.
        |  stop(Pid) -&gt;
<font color=red>     0..|    gen_server:call(Pid, stop).</font>
        |  
        |  -spec state(pid()) -&gt; line_state().
        |  state(Pid) -&gt;
<font color=red>     0..|    gen_server:call(Pid, state).</font>
        |  
        |  -spec ?GET_NEXT_STOP(pid(), pid(), pid()) -&gt; {pid(), pos_integer()} | none.
        |  ?GET_NEXT_STOP(Pid, Target, Stop) -&gt;
<font color=red>     0..|    gen_server:call(Pid, {?GET_NEXT_STOP, Target, Stop}).</font>
        |  
        |  -spec ?GET_NEIGHBORS(pid(), pid()) -&gt; [{pid(), pos_integer(), pid(), pid()}].
        |  ?GET_NEIGHBORS(Pid, Stop) -&gt;
 63046..|    gen_server:call(Pid, {?GET_NEIGHBORS, Stop}).
        |  
        |  -spec ?GET_OTHER_END(pid(), pid()) -&gt; pid().
        |  ?GET_OTHER_END(Pid, Stop) -&gt;
<font color=red>     0..|    gen_server:call(Pid, {?GET_OTHER_END, Stop}).</font>
        |  
        |  -spec ?CONTAINS_STOP(pid(), pid()) -&gt; boolean().
        |  ?CONTAINS_STOP(Pid, Stop) -&gt;
707353..|    gen_server:call(Pid, {?CONTAINS_STOP, Stop}).
        |  
        |  -spec ?GET_DURATION(pid(), pid(), pid()) -&gt; pos_integer().
        |  ?GET_DURATION(Pid, FromStop, ToStop) -&gt;
  2188..|    gen_server:call(Pid, {?GET_DURATION, FromStop, ToStop}).
        |  
        |  -spec ?IS_END_STOP(pid(), pid()) -&gt; boolean().
        |  ?IS_END_STOP(Pid, Stop) -&gt;
<font color=red>     0..|    gen_server:call(Pid, {?IS_END_STOP, Stop}).</font>
        |  
        |  -spec ?GET_INTERSECTION(pid(), pid()) -&gt; pid() | none.
        |  ?GET_INTERSECTION(Pid, OtherLine) -&gt;
 83699..|    gen_server:call(Pid, {?GET_INTERSECTION, OtherLine}).
        |  
        |  -spec ?GET_NUMBER(pid()) -&gt; pos_integer().
        |  ?GET_NUMBER(Pid) -&gt;
<font color=red>     0..|    gen_server:call(Pid, ?GET_NUMBER).</font>
        |  
        |  -spec ?GET_TARGET(pid(), pid(), pid()) -&gt; pid().
        |  ?GET_TARGET(Pid, FromStop, ToStop) -&gt;
  1094..|    gen_server:call(Pid, {?GET_TARGET, FromStop, ToStop}).
        |  
        |  
        |  %% gen_server
        |  
        |  -spec init({pos_integer(), [pid() | pos_integer()], vehicle_type()}) -&gt; {ok, line_state()}.
        |  init({Number, Stops, Type}) -&gt;
        |    %gen_server:call(blackboard, {subscribe, time}),
     8..|    {ok, #line_state{number=Number, stops=Stops, type=Type}}.
        |  
        |  
        |  -spec handle_call({?GET_NEXT_STOP, pid(), pid()}, {pid(), any()}, line_state()) -&gt; {reply, {pid(), pos_integer()} | none, line_state()}
        |        ;          ({?GET_NEIGHBORS, pid()},        {pid(), any()}, line_state()) -&gt; {reply, [{pid(), pos_integer(), pid(), pid()}], line_state()}
        |        ;          ({?GET_OTHER_END, pid()},        {pid(), any()}, line_state()) -&gt; {reply, pid(), line_state()}
        |        ;          ({?CONTAINS_STOP, pid()},        {pid(), any()}, line_state()) -&gt; {reply, boolean(), line_state()}
        |        ;          ({?GET_DURATION, pid(), pid()},  {pid(), any()}, line_state()) -&gt; {reply, boolean(), line_state()}
        |        ;          ({?IS_END_STOP, pid()},          {pid(), any()}, line_state()) -&gt; {reply, boolean(), line_state()}
        |        ;          ({?GET_INTERSECTION, pid()},     {pid(), any()}, line_state()) -&gt; {reply, pid() | none, line_state()}
        |        ;          (?GET_NUMBER,                    {pid(), any()}, line_state()) -&gt; {reply, pos_integer(), line_state()}
        |        ;          ({?GET_TARGET, pid(), pid()},    {pid(), any()}, line_state()) -&gt; {reply, pid(), line_state()}
        |        ;          (stop,                           {pid(), any()}, line_state()) -&gt; {stop, normal, stopped, line_state()}
        |        ;          (state,                          {pid(), any()}, line_state()) -&gt; {reply, line_state(), line_state()}.
        |  handle_call({?GET_NEXT_STOP, Target, Stop}, _From, State) -&gt;
<font color=red>     0..|    [EndStop|_] = State#line_state.stops,</font>
<font color=red>     0..|    Reply = case EndStop of</font>
<font color=red>     0..|              Target -&gt; get_next_stop_helper(Stop, pre, State#line_state.stops);</font>
<font color=red>     0..|              _      -&gt; get_next_stop_helper(Stop, post, State#line_state.stops)</font>
        |            end,
<font color=red>     0..|    {reply, Reply, State};</font>
        |  
        |  handle_call({?GET_NEIGHBORS, Stop}, _From, State) -&gt;
 54204..|    {BeforeStop, [Stop|AfterStop]} = lists:splitwith(fun(X) -&gt; X /= Stop end, State#line_state.stops),
 54204..|    N1 = case BeforeStop of
        |           [FirstTarget|_] -&gt;
 45663..|             FirstNeighbor = lists:last(lists:droplast(BeforeStop)),
 45663..|             [{FirstNeighbor, lists:last(BeforeStop), FirstTarget, self()}];
        |           [] -&gt;
  8541..|             []
        |         end,
 54204..|    N2 = case AfterStop of
        |           [SecondDur|[SecondNeighbor|_]] -&gt;
 49264..|             [{SecondNeighbor, SecondDur, lists:last(AfterStop), self()}];
        |           [] -&gt;
  4940..|             []
        |         end,
 54204..|    Reply = N1 ++ N2,
 54204..|    {reply, Reply, State};
        |  
        |  handle_call({?GET_OTHER_END, Stop}, _From, State) -&gt;
<font color=red>     0..|    [H|T] = State#line_state.stops,</font>
<font color=red>     0..|    Reply = case H of</font>
<font color=red>     0..|              Stop -&gt; lists:last(T);</font>
<font color=red>     0..|              _    -&gt; H</font>
        |            end,
<font color=red>     0..|    {reply, Reply, State};</font>
        |  
        |  handle_call({?CONTAINS_STOP, Stop}, _From, State) -&gt;
681793..|    Reply = lists:member(Stop, State#line_state.stops),
681793..|    {reply, Reply, State};
        |  
        |  handle_call({?GET_DURATION, FromStop, ToStop}, _From, State) -&gt;
  2188..|    Reply = get_duration_helper(FromStop, ToStop, State#line_state.stops),
  2188..|    {reply, Reply, State};
        |  
        |  handle_call({?IS_END_STOP, Stop}, _From, State) -&gt;
<font color=red>     0..|    Reply = lists:prefix([Stop], State#line_state.stops) or lists:suffix([Stop], State#line_state.stops),</font>
<font color=red>     0..|    {reply, Reply, State};</font>
        |  
        |  handle_call({?GET_INTERSECTION, OtherLine}, _From, State) -&gt;
 70174..|    Reply = get_intersection_helper(OtherLine, State#line_state.stops),
 70172..|    {reply, Reply, State};
        |  
        |  handle_call(?GET_NUMBER, _From, State) -&gt;
<font color=red>     0..|    Reply = State#line_state.number,</font>
<font color=red>     0..|    {reply, Reply, State};</font>
        |  
        |  handle_call({?GET_TARGET, FromStop, ToStop}, _From, State) -&gt;
  1094..|    Reply = get_target_helper(FromStop, ToStop, State#line_state.stops),
  1094..|    {reply, Reply, State};
        |  
        |  handle_call(stop, _From, State) -&gt;
<font color=red>     0..|    {stop, normal, stopped, State};</font>
        |  
        |  handle_call(state, _From, State) -&gt;
<font color=red>     0..|    {reply, State, State}.</font>
        |  
        |  
        |  -spec handle_cast(any(), line_state()) -&gt; {noreply, line_state()}.
        |  handle_cast(_Cast, State) -&gt;
<font color=red>     0..|    {noreply, State}.</font>
        |  
        |  
        |  -spec handle_info(timeout | any(), line_state()) -&gt; {noreply, line_state()}.
        |  handle_info(_Info, State) -&gt;
<font color=red>     0..|    {noreply, State}.</font>
        |  
        |  
        |  -spec terminate(normal | shutdown | {shutdown, any()} | any(), line_state()) -&gt; ok.
        |  terminate(_Reason, _State) -&gt;
<font color=red>     0..|    ok.</font>
        |  
        |  
        |  -spec code_change(term() | {down, term()}, stop_state(), term()) -&gt; {ok, line_state()}.
        |  code_change(_OldVsn, State, _Extra) -&gt;
<font color=red>     0..|    {ok, State}.</font>
        |  
        |  
        |  %% Backend
        |  
        |  -spec get_next_stop_helper(pid(), pre | post, [pid() | pos_integer()]) -&gt; {pid(), pos_integer()} | none.
<font color=red>     0..|  get_next_stop_helper(_Stop, _, [_|[]]) -&gt; none; %%TODO ERROR log, since vehicles should always turn around when they arrive at their end stations. There should always be a next stop.</font>
        |  get_next_stop_helper(Stop, pre, [NextStop|[Dur|[Stop|_]]]) -&gt;
<font color=red>     0..|    {NextStop, Dur};</font>
        |  get_next_stop_helper(Stop, post, [Stop|[Dur|[NextStop|_]]]) -&gt;
<font color=red>     0..|    {NextStop, Dur};</font>
        |  get_next_stop_helper(Stop, Alignment, [_S|[_Dur|Stops]]) -&gt;
<font color=red>     0..|    get_next_stop_helper(Stop, Alignment, Stops).</font>
        |  
        |  -spec get_duration_helper(pid(), pid(), [pid() | pos_integer()]) -&gt; pos_integer().
        |  get_duration_helper(FromStop, ToStop, Stops) -&gt;
  2188..|    get_duration_helper(FromStop, ToStop, false, Stops).
        |  
        |  -spec get_duration_helper(pid(), pid(), boolean(), [pid() | pos_integer()]) -&gt; non_neg_integer().
  2188..|  get_duration_helper(_FromStop, ToStop, true, [ToStop|_Stops]) -&gt; 0;
<font color=red>     0..|  get_duration_helper(FromStop, _ToStop, true, [FromStop|_Stops]) -&gt; 0;</font>
        |  get_duration_helper(FromStop, ToStop, _OnPath, [FromStop|[Dur|Stops]]) -&gt;
  2188..|    Dur + get_duration_helper(FromStop, ToStop, true, Stops);
        |  get_duration_helper(FromStop, ToStop, _OnPath, [ToStop|[Dur|Stops]]) -&gt;
<font color=red>     0..|    Dur + get_duration_helper(FromStop, ToStop, true, Stops);</font>
        |  get_duration_helper(FromStop, ToStop, OnPath, [_S|[Dur|Stops]]) -&gt;
  1094..|    case OnPath of
        |      true -&gt;
<font color=red>     0..|        Dur + get_duration_helper(FromStop, ToStop, true, Stops);</font>
        |      false -&gt;
  1094..|        get_duration_helper(FromStop, ToStop, false, Stops)
        |    end.
        |  
        |  -spec get_intersection_helper(pid(), [pid() | pos_integer()]) -&gt; pid() | none.
        |  get_intersection_helper(OtherLine, [Stop|Rest]) -&gt;
405268..|    ContainsStop = ?CONTAINS_STOP(OtherLine, Stop),
405266..|    case ContainsStop of
        |      true -&gt;
  1094..|        Stop;
        |      false -&gt;
404172..|        case Rest of
        |          [] -&gt;
 69078..|            none;
        |          [_|Stops] -&gt;
335094..|            get_intersection_helper(OtherLine, Stops)
        |        end
        |    end.
        |  
        |  -spec get_target_helper(pid(), pid(), [pid() | pos_integer()]) -&gt; pid().
        |  get_target_helper(FromStop, ToStop, [FirstEnd|[_|Stops]]) -&gt;
  1094..|    get_target_helper(FromStop, ToStop, FirstEnd, lists:filter(fun(Stop) -&gt; is_pid(Stop) end, Stops)).
        |  
        |  -spec get_target_helper(pid(), pid(), pid(), [pid() | pos_integer()]) -&gt; pid().
        |  get_target_helper(FromStop, _ToStop, FromStop, Stops) -&gt;
<font color=red>     0..|    lists:last(Stops);</font>
        |  get_target_helper(FromStop, ToStop, FirstEnd, [Stop|Stops]) -&gt;
  1094..|    case Stop of
        |      FromStop -&gt;
  1094..|        lists:last(Stops);
        |      ToStop -&gt;
<font color=red>     0..|        FirstEnd;</font>
        |      Stop -&gt;
<font color=red>     0..|        get_target_helper(FromStop, ToStop, FirstEnd, Stops)</font>
        |    end.
</pre>
</body>
</html>
